<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Tienda de Componentes PC{% endblock %}</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body class="{% block body_class %}{% endblock %}">
    <div class="main-container">
        <header class="header">
            <div class="logo-location">
                <a href="{{ url_for('home') }}">
                    <img src="{{ url_for('static', filename='images/Uparshop-logo.png') }}" alt="Logo" class="logo" />
                </a>
                <div class="location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Selecciona tu<br /><b>Dirección</b></span>
                </div>
            </div>
            <div class="search-bar">
                <form action="{{ url_for('buscar') }}" method="get" style="display:flex; width:100%;">
                    <input type="text" name="q" placeholder="Buscar productos, ej: 'laptop'" value="{{ request.args.get('q','') }}" />
                    <button type="submit"><i class="fas fa-search"></i></button>
                </form>
            </div>
            <div class="user-actions">
                <a href="{% if session.user_email %}{{ url_for('ver_carrito') }}{% else %}{{ url_for('login') }}{% endif %}" class="cart" style="position:relative;">
                    <i class="fas fa-shopping-cart"></i>
                    {% set total_items = session.get('carrito', {}) %}
                    {% set total_count = total_items.values()|map('int')|sum %}
                    <span id="cart-count" class="cart-count" {% if not total_count %}style="display:none;"{% endif %}>{{ total_count }}</span>
                </a>
                {% if session.get('user_rol') == 'admin' %}
                <a href="{{ url_for('admin') }}" target="_blank" rel="noopener noreferrer" class="admin-shortcut" style="margin-right:12px; display:inline-flex; align-items:center; gap:6px; background:#243447; padding:8px 14px; border-radius:6px; color:#fff; font-weight:500; text-decoration:none; font-size:0.85rem;" title="Abrir Panel Admin en nueva pestaña">
                    <i class="fas fa-gauge-high" style="color:#6dd3ff;"></i> Admin
                </a>
                {% endif %}
                {% if session.user_email %}
                <div class="account-logged">
                    <i class="fas fa-user"></i>
                    <div class="dropdown">
                        <span class="dropdown-toggle"><b>{{ session.user_email }}</b></span>
                        <div class="dropdown-menu">
                            {% if session.get('user_rol') == 'admin' %}
                            <a href="{{ url_for('admin') }}" class="admin-panel-link" target="_blank">Panel Admin</a>
                            {% endif %}
                            <a href="{{ url_for('logout') }}" class="logout-link">Cerrar sesión</a>
                        </div>
                    </div>
                </div>
                {% else %}
                <a href="{{ url_for('login') }}" class="account-link">Entrar</a>
                {% endif %}
            </div>
        </header>

        <nav class="navbar">
            <a href="{{ url_for('lista_precios') }}">Lista de precios <i class="fas fa-tags"></i></a>
            <a href="{{ url_for('sobre_nosotros') }}">Sobre nosotros <i class="fas fa-info-circle"></i></a>
            <a href="{{ url_for('contactanos') }}">Contáctanos <i class="fas fa-envelope"></i></a>
        </nav>

        <div class="content-area">
            <aside class="sidebar">
                <h3>Categorías <i class="fas fa-stream"></i></h3>
                <ul>
                    <li><a href="{{ url_for('torres') }}"><i class="fas fa-desktop"></i> Torres</a></li>
                    <li><a href="{{ url_for('laptops') }}"><i class="fas fa-laptop"></i> Laptops</a></li>
                    <li><a href="{{ url_for('procesadores') }}"><i class="fas fa-microchip"></i> Procesadores</a></li>
                    <li><a href="{{ url_for('tarjetas_graficas') }}"><i class="fas fa-gamepad"></i> Tarjetas Gráficas</a></li>
                    <li><a href="{{ url_for('perifericos') }}"><i class="fas fa-keyboard"></i> Periféricos</a></li>
                    <li><a href="{{ url_for('memorias') }}"><i class="fas fa-memory"></i> Memorias</a></li>
                    <li><a href="{{ url_for('fuentes') }}"><i class="fas fa-bolt"></i> Fuentes</a></li>
                    <li><a href="{{ url_for('juegos') }}"><i class="fas fa-ghost"></i> Juegos</a></li>

                </ul>
            </aside>

            <main class="products-section">
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="flash-messages">
                    {% for category, msg in messages %}
                        <div class="flash {{ category }}">{{ msg }}</div>
                    {% endfor %}
                </div>
                <script>
                // Auto-hide flash messages after 4s
                setTimeout(()=>{ document.querySelectorAll('.flash').forEach(el=>{el.style.transition='opacity .5s'; el.style.opacity='0'; setTimeout(()=>el.remove(),600); }); }, 4000);
                </script>
                {% endif %}
                {% endwith %}
                {% block content %}
                <!-- Contenido específico de cada página -->
                {% endblock %}
            </main>
        </div>
    </div>
</body>
</html>
<script>
function animateCartIcon() {
    var cartIcon = document.querySelector('.cart');
    if(cartIcon) {
        cartIcon.classList.add('cart-animate');
        setTimeout(function(){ cartIcon.classList.remove('cart-animate'); }, 600);
    }
}
// Detectar mensaje de producto agregado y animar
if (window.location.search.includes('carrito_anim')) {
    animateCartIcon();
}
</script>
<style>
.cart-animate {
    animation: cart-bounce 0.6s;
}
@keyframes cart-bounce {
    0% { transform: scale(1); }
    30% { transform: scale(1.25) rotate(-10deg); }
    60% { transform: scale(0.95) rotate(8deg); }
    100% { transform: scale(1); }
}
</style>
