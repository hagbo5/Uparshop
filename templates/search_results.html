{% extends 'base.html' %}
{% block title %}Resultados de búsqueda{% endblock %}

{% block content %}
<div class="container">
  <h2>Resultados para "{{ query }}"</h2>
  {% if productos and productos|length > 0 %}
  <div class="products-grid">
    {% for producto in productos %}
    <div class="product-card">
      {# Imagen: si es URL absoluta la usamos tal cual, si no buscamos en static/images/productos/ #}
      {# Use resolved imagen_web set by the buscar route when available #}
      <a href="{{ url_for('producto_detalle', producto_id=producto.id_producto) }}">
        {% if producto.imagen_web %}
          <img src="{{ producto.imagen_web }}" alt="{{ producto.nombre }}">
        {% elif producto.imagen and 'http' in producto.imagen %}
          <img src="{{ producto.imagen }}" alt="{{ producto.nombre }}">
        {% else %}
          <img src="{{ url_for('static', filename='images/Uparshop-logo.png') }}" alt="{{ producto.nombre }}">
        {% endif %}
      </a>

      <div class="product-info">
        <h3 class="product-title">{{ producto.nombre }}</h3>
        <p class="product-description">{{ producto.descripcion[:240] }}{% if producto.descripcion|length > 240 %}...{% endif %}</p>
        <p class="price">${{ '%.2f'|format(producto.precio_unitario or 0) }}</p>
        <p class="meta">Categoria: {{ producto.categoria.nombre if producto.categoria else 'Sin categoría' }} • Stock: {{ producto.cantidad_stock or 0 }} {{ producto.unidad or '' }}</p>
        {# garantia ocultada intencionalmente #}
        <a class="btn" href="{{ url_for('producto_detalle', producto_id=producto.id_producto) }}">Ver detalle</a>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p>No se encontraron productos que coincidan con tu búsqueda.</p>
  {% endif %}
</div>
{% endblock %}
