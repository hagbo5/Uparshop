<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Panel de Administración{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/_variables.css') }}?v=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}?v=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}?v=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/forms.css') }}?v=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}?v=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}?v=1" />
</head>
<body>
    <div class="admin-layout">
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Abrir menú" aria-expanded="false" aria-controls="adminSidebar">
            <i class="fas fa-bars"></i>
        </button>
        <div id="sidebarOverlay"></div>
        <aside class="admin-sidebar" id="adminSidebar">
            <h3>Panel Admin</h3>
            <ul class="admin-menu">
                <li><a href="{{ url_for('admin.admin_index') }}" class="{% if request.endpoint=='admin.admin_index' %}active{% endif %}"><i class="fas fa-gauge-high"></i> <span>Dashboard</span></a></li>
                <li><a href="{{ url_for('admin.admin_productos') }}" class="{% if request.endpoint=='admin.admin_productos' or request.endpoint in ['admin.editar_producto','admin.registrar_producto'] %}active{% endif %}"><i class="fas fa-box"></i> <span>Productos</span> <span class="badge-count">{{ admin_counts.productos if admin_counts else '' }}</span></a></li>
                <li><a href="{{ url_for('admin.admin_usuario') }}" class="{% if request.endpoint=='admin.admin_usuario' or 'usuario' in request.endpoint %}active{% endif %}"><i class="fas fa-users"></i> <span>Usuarios</span> <span class="badge-count">{{ admin_counts.usuarios if admin_counts else '' }}</span></a></li>
                <li><a href="{{ url_for('admin.admin_mensajes') }}" class="{% if request.endpoint=='admin.admin_mensajes' %}active{% endif %}"><i class="fas fa-envelope"></i> <span>Mensajes</span> <span class="badge-count" id="badge-mensajes">{{ admin_counts.mensajes if admin_counts else '' }}</span></a></li>
                <li><a href="#"><i class="fas fa-shopping-bag"></i> Pedidos</a></li>
                <li><a href="#"><i class="fas fa-chart-line"></i> Reportes</a></li>
                <li><a href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a></li>
            </ul>
        </aside>
        <main class="admin-content">
            {% block content %}{% endblock %}
        </main>
    </div>
    <script>
    (function(){
        const sidebar = document.getElementById('adminSidebar');
        const toggle = document.getElementById('sidebarToggle');
        const overlay = document.getElementById('sidebarOverlay');
        const mq = window.matchMedia('(max-width: 900px)');
        let isOpen = false;

        function applyMode(){
            if(mq.matches){
                toggle.style.display='inline-flex';
                sidebar.classList.add('collapsed');
            } else {
                toggle.style.display='none';
                sidebar.classList.remove('collapsed','open');
                overlay.style.display='none';
                toggle.setAttribute('aria-expanded','false');
                isOpen=false;
            }
        }
        function openSidebar(){
            sidebar.classList.add('open');
            overlay.style.display='block';
            toggle.setAttribute('aria-expanded','true');
            isOpen=true;
            // focus first link
            const firstLink = sidebar.querySelector('a');
            if(firstLink) firstLink.focus();
        }
        function closeSidebar(){
            sidebar.classList.remove('open');
            overlay.style.display='none';
            toggle.setAttribute('aria-expanded','false');
            isOpen=false;
            toggle.focus();
        }
        toggle.addEventListener('click', ()=>{ isOpen? closeSidebar(): openSidebar(); });
        overlay.addEventListener('click', closeSidebar);
        document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && isOpen) closeSidebar(); });
        window.addEventListener('resize', applyMode);
        applyMode();
    })();
    </script>
</body>
</html>
